<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minha Agenda - NutriCare</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/vanillajs-datepicker@1.3.4/dist/css/datepicker-bs5.min.css">
    <link rel="stylesheet" href="../../css/style.css">
</head>
<body>
    <div class="dashboard-wrapper">
        <aside class="dashboard-sidebar">
            <div class="sidebar-header"><a class="navbar-brand" href="#"><i class="bi bi-heart-pulse-fill"></i> NutriCare</a></div>
            <nav class="sidebar-nav">
                <ul class="list-unstyled">
                    <li class="nav-item"><a href="dashboard.html" class="nav-link"><i class="bi bi-grid-1x2-fill"></i> In√≠cio</a></li>
                    <li class="nav-item"><a href="planoAlimentar.html" class="nav-link"><i class="bi bi-file-earmark-text-fill"></i> Plano Alimentar</a></li>
                    <li class="nav-item active"><a href="agenda.html" class="nav-link"><i class="bi bi-calendar2-week-fill"></i> Minha Agenda</a></li>
                    <li class="nav-item"><a href="encaminhamentos.html" class="nav-link"><i class="bi bi-folder-symlink-fill"></i> Encaminhamentos</a></li>
                    <li class="nav-item"><a href="receituario.html" class="nav-link"><i class="bi bi-capsule-pill"></i> Receitu√°rio</a></li>
                    <li class="nav-item"><a href="pagamentos.html" class="nav-link"><i class="bi bi-wallet-fill"></i> Pagamentos</a></li>
                    <li class="nav-item"><a href="configuracoes.html" class="nav-link"><i class="bi bi-person-fill-gear"></i> Configura√ß√µes</a></li>
                </ul>
            </nav>
            <div class="sidebar-footer"><button id="logoutBtn" class="btn btn-logout w-100"><i class="bi bi-box-arrow-left"></i> Sair</button></div>
        </aside>

        <main class="dashboard-main">
            <header class="dashboard-content-header d-flex justify-content-between align-items-center">
                <h1>Minha Agenda</h1>
            </header>
            
            <div class="row g-4 mb-4">
                <div class="col-12" id="nextAppointmentHighlight">
                    </div>
            </div>
            
            <div class="card data-card">
                <div class="card-header">
                     <h5 class="card-title mb-0"><i class="bi bi-list-check me-2"></i> Lista de Agendamentos</h5>
                </div>
                <div class="card-body p-0">
                    <div id="appointmentsListContainer" class="list-group list-group-flush">
                        </div>
                </div>
            </div>

            <div id="emptyAgendaState" class="empty-state-card" style="display: none;">
                <div class="empty-state-icon"><i class="bi bi-calendar2-heart"></i></div>
                <h5 class="empty-state-title">Nenhum agendamento futuro! üóìÔ∏è</h5>
            </div>
        </main>
    </div>

    <div class="modal-backdrop" id="actionConfirmModal">
        <div class="modal-content text-center">
            <button class="modal-close" id="closeActionConfirmModal">&times;</button>
            <h4 class="auth-title" id="modalActionTitle">Confirmar A√ß√£o</h4>
            <p class="text-muted mb-4" id="modalActionMessage">Voc√™ tem certeza que deseja cancelar esta consulta?</p>
            <div class="modal-actions d-flex justify-content-center gap-3 mt-4">
                <button id="btnCancelAction" class="btn btn-secondary w-100">N√£o, Manter</button>
                <button id="btnConfirmAction" class="btn btn-danger w-100"><i class="bi bi-check-circle"></i> Sim, Cancelar</button>
            </div>
        </div>
    </div>
    
    <div class="modal-backdrop" id="appointmentDetailsModal">
        <div class="modal-content pro-modal">
            <button class="modal-close" id="closeDetailsModal">&times;</button>
            <div class="modal-icon"><i class="bi bi-calendar-event"></i></div>
            <h4 class="modal-title-pro" id="modalServiceType">Detalhes da Consulta</h4>
            <p class="modal-subtitle-pro">Informa√ß√µes completas do seu pr√≥ximo compromisso.</p>
            
            <div class="text-start mb-4 p-3 bg-light rounded">
                <p class="mb-2"><strong><i class="bi bi-clock-fill me-2"></i> Data e Hora:</strong> <span id="modalDateTime" class="text-dark-charcoal"></span></p>
                <p class="mb-2"><strong><i class="bi bi-stopwatch-fill me-2"></i> Dura√ß√£o:</strong> <span id="modalDuration" class="text-dark-charcoal"></span></p>
                <p class="mb-0"><strong><i class="bi bi-person-badge-fill me-2"></i> Nutricionista:</strong> <span id="modalNutriName" class="text-dark-charcoal"></span></p>
            </div>

            <div class="text-start mb-4 p-3 bg-light rounded">
                 <p class="mb-2"><strong><i class="bi bi-whatsapp me-2"></i> Telefone Nutri:</strong> <span id="modalNutriPhone" class="text-dark-charcoal"></span></p>
                <a id="modalWppLink" class="btn-wpp-large w-100" target="_blank" style="display: none;">
                    <i class="bi bi-whatsapp me-2"></i> Enviar Mensagem Direta
                </a>
            </div>

            <div class="d-flex justify-content-center gap-3">
                 <button id="modalCancelBtn" class="btn btn-outline-secondary w-100"><i class="bi bi-x-circle me-1"></i> Cancelar</button>
                 <button id="modalRescheduleBtn" class="btn btn-primary-custom w-100"><i class="bi bi-arrow-repeat me-1"></i> Reagendar</button>
            </div>
            
        </div>
    </div>
    
    <div class="modal-backdrop" id="rescheduleModal">
        <div class="modal-content pro-modal modal-lg">
            <button class="modal-close" id="closeRescheduleModal">&times;</button>
            <div class="modal-icon"><i class="bi bi-arrow-repeat"></i></div>
            <h4 class="modal-title-pro">Reagendar Consulta</h4>
            <p class="modal-subtitle-pro mb-4">Escolha uma nova data e hor√°rio para a sua consulta de <strong id="rescheduleServiceType">...</strong>.</p>
            
            <div id="rescheduleFlow">
                 <div id="rescheduleStep1" class="booking-step active">
                    <h5 class="fw-bold mb-3">1. Selecione a nova data e hor√°rio</h5>
                    <div id="reschedule-alert-message" class="alert alert-warning" style="display: none;"></div>
                    <div class="row">
                        <div class="col-md-6">
                            <div id="rescheduleDatepicker" class="mb-4"></div>
                        </div>
                        <div class="col-md-6">
                            <div id="reschedule-time-slots-container">
                                <h6 class="text-center" id="rescheduleSelectedDate">Escolha uma data no calend√°rio</h6>
                                <div class="time-slots-list" id="rescheduleTimeSlots">
                                    </div>
                                <div id="reschedule-slots-loader" class="text-center mt-3" style="display: none;">
                                    <span class="spinner-border spinner-border-sm text-primary"></span> Carregando hor√°rios...
                                </div>
                            </div>
                        </div>
                    </div>
                     <div class="d-flex justify-content-end">
                         <button class="btn btn-primary-custom" id="goToRescheduleConfirm" disabled>
                             Confirmar Hor√°rio <i class="bi bi-arrow-right-short"></i>
                         </button>
                     </div>
                 </div>

                 <div id="rescheduleStep2" class="booking-step">
                      <h5 class="fw-bold mb-3">2. Confirma√ß√£o do Reagendamento</h5>
                       <div class="booking-summary">
                            <p><i class="bi bi-card-checklist"></i> <strong>Servi√ßo:</strong> <span id="confirmRescheduleService"></span></p>
                            <p><i class="bi bi-calendar-check"></i> <strong>Novo Hor√°rio:</strong> <span id="confirmRescheduleDateTime"></span></p>
                            <p><i class="bi bi-person-fill"></i> <strong>Nutricionista:</strong> <span id="confirmRescheduleNutri"></span></p>
                        </div>
                        
                        <div id="reschedule-submit-message" class="form-message-container mb-3"></div>
                        
                        <div class="d-flex justify-content-between">
                            <button type="button" class="btn btn-outline-secondary" id="backToRescheduleDate"><i class="bi bi-arrow-left"></i> Voltar</button>
                            <button type="submit" class="btn btn-primary-custom" id="submitRescheduleBtn">
                                Solicitar Reagendamento
                            </button>
                        </div>
                 </div>
            </div>
        </div>
    </div>
    
    <div id="customToast" class="custom-toast">
        <div class="toast-icon"><i class="bi bi-check-circle-fill"></i></div>
        <div class="toast-message">A√ß√£o realizada com sucesso.</div>
    </div>

    <div class="modal-backdrop" id="surveyModal">
        <div class="modal-content pro-modal modal-lg">
            <button class="modal-close" id="closeSurveyModal">&times;</button>
            <div class="modal-icon"><i class="bi bi-star-half"></i></div>
            <h4 class="modal-title-pro">Avalie sua Consulta</h4>
            <p class="modal-subtitle-pro">Seu feedback √© muito importante para n√≥s!</p>
            
            <form id="surveyForm">
                <input type="hidden" id="surveyAppointmentId">

                <div class="survey-section">
                    <h5 class="survey-section-title">Como voc√™ avalia sua consulta com a <strong id="surveyNutriName">...</strong>?</h5>
                    <div class="rating-stars" data-for="nutri">
                        <i class="bi bi-star" data-value="1"></i>
                        <i class="bi bi-star" data-value="2"></i>
                        <i class="bi bi-star" data-value="3"></i>
                        <i class="bi bi-star" data-value="4"></i>
                        <i class="bi bi-star" data-value="5"></i>
                    </div>
                    <input type="hidden" id="nutriRating" required>
                    <textarea class="form-control mt-3" id="nutriComments" placeholder="Deixe um coment√°rio (opcional)..."></textarea>
                </div>

                <div class="survey-section" id="mealPlanSurveySection" style="display: none;">
                    <h5 class="survey-section-title">E sobre o seu Plano Alimentar?</h5>
                     <p class="small text-muted">Ele foi f√°cil de seguir? Voc√™ gostou das op√ß√µes?</p>
                    <div class="rating-stars" data-for="mealPlan">
                        <i class="bi bi-star" data-value="1"></i>
                        <i class="bi bi-star" data-value="2"></i>
                        <i class="bi bi-star" data-value="3"></i>
                        <i class="bi bi-star" data-value="4"></i>
                        <i class="bi bi-star" data-value="5"></i>
                    </div>
                    <input type="hidden" id="mealPlanRating">
                    <textarea class="form-control mt-3" id="mealPlanComments" placeholder="Seu feedback sobre o plano (opcional)..."></textarea>
                </div>

                <div class="survey-section">
                    <h5 class="survey-section-title">De 0 a 10, qual a probabilidade de voc√™ recomendar o sistema NutriCare a um colega?</h5>
                    <div class="rating-nps" data-for="system">
                        <button type="button" class="nps-score" data-value="0">0</button>
                        <button type="button" class="nps-score" data-value="1">1</button>
                        <button type="button" class="nps-score" data-value="2">2</button>
                        <button type="button" class="nps-score" data-value="3">3</button>
                        <button type="button" class="nps-score" data-value="4">4</button>
                        <button type="button" class="nps-score" data-value="5">5</button>
                        <button type="button" class="nps-score" data-value="6">6</button>
                        <button type="button" class="nps-score" data-value="7">7</button>
                        <button type="button" class="nps-score" data-value="8">8</button>
                        <button type="button" class="nps-score" data-value="9">9</button>
                        <button type="button" class="nps-score" data-value="10">10</button>
                    </div>
                    <div class="d-flex justify-content-between small text-muted mt-1 px-2">
                        <span>Pouco Prov√°vel</span>
                        <span>Muito Prov√°vel</span>
                    </div>
                    <input type="hidden" id="systemRating" required>
                    <textarea class="form-control mt-3" id="systemComments" placeholder="O que podemos melhorar? (opcional)"></textarea>
                </div>
                
                <div id="survey-message" class="form-message-container mt-3"></div>
                
                <button type="submit" class="btn btn-primary-custom w-100 mt-3 position-relative" id="submitSurveyBtn">
                    <span class="btn-text">Enviar Avalia√ß√£o</span>
                    <div class="spinner-container" style="display: none;">
                        <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                    </div>
                </button>
            </form>
        </div>
    </div>
    
    <div id="whatsapp-widget" class="whatsapp-widget"><i class="bi bi-whatsapp"></i></div>
    <div class="modal-backdrop" id="contactNutriModal">
        <div class="modal-content text-center">
            <button class="modal-close" id="closeContactModal">&times;</button>
            <h4 class="card-title">Fale com sua Nutri</h4>
            <p class="text-muted mb-3">Dra. <strong id="nutriName"></strong></p>
            <button class="btn-modal-wpp" id="sendText"><i class="bi bi-whatsapp"></i> Enviar Mensagem</button>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/vanillajs-datepicker@1.3.4/dist/js/datepicker-full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script type="module" src="../../js/dashboard-paciente.js"></script>
</body>
</html>